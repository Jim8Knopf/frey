# ==============================================================================
# MEALIE ENVIRONMENT CONFIGURATION
# ==============================================================================

# ------------------------------------------------------------------------------
# Base Configuration
# ------------------------------------------------------------------------------
BASE_URL={{ cookbook.services.mealie.base_url }}
API_DOCS={{ cookbook.services.mealie.api_docs | default(true) | lower }}

# ------------------------------------------------------------------------------
# Database Configuration
# ------------------------------------------------------------------------------
DB_ENGINE=postgres
POSTGRES_USER={{ cookbook.db_user | default('mealie') }}
POSTGRES_PASSWORD={{ cookbook.db_password | default(lookup('password', storage.base_dir + '/appdata/mealie/.db_password length=32 chars=ascii_letters,digits')) }}
POSTGRES_SERVER=mealie-postgres
POSTGRES_PORT=5432
POSTGRES_DB={{ cookbook.db_name | default('mealie') }}

# Database credentials (for compose)
DB_USER={{ cookbook.db_user | default('mealie') }}
DB_PASSWORD={{ cookbook.db_password | default(lookup('password', storage.base_dir + '/appdata/mealie/.db_password length=32 chars=ascii_letters,digits')) }}
DB_NAME={{ cookbook.db_name | default('mealie') }}

# ------------------------------------------------------------------------------
# Security & Authentication
# ------------------------------------------------------------------------------
ALLOW_SIGNUP={{ cookbook.services.mealie.allow_signup | default(false) | lower }}
TOKEN_TIME=48  # API token validity in hours

# SSO - OIDC Configuration (disabled by default)
OIDC_AUTH_ENABLED={{ cookbook.services.mealie.oidc_enabled | default(false) | lower }}
{% if cookbook.services.mealie.oidc_enabled | default(false) %}
OIDC_CONFIGURATION_URL={{ cookbook.services.mealie.oidc_configuration_url }}
OIDC_CLIENT_ID={{ cookbook.services.mealie.oidc_client_id }}
OIDC_USER_GROUP={{ cookbook.services.mealie.oidc_user_group | default('mealie_users') }}
OIDC_ADMIN_GROUP={{ cookbook.services.mealie.oidc_admin_group | default('mealie_admins') }}
OIDC_AUTO_REDIRECT={{ cookbook.services.mealie.oidc_auto_redirect | default(false) | lower }}
{% endif %}

# LDAP Configuration (disabled by default)
{% if cookbook.services.mealie.ldap_enabled | default(false) %}
LDAP_AUTH_ENABLED=true
LDAP_SERVER_URL={{ cookbook.services.mealie.ldap_server_url }}
LDAP_BASE_DN={{ cookbook.services.mealie.ldap_base_dn }}
LDAP_QUERY_BIND={{ cookbook.services.mealie.ldap_query_bind }}
LDAP_QUERY_PASSWORD={{ cookbook.services.mealie.ldap_query_password }}
LDAP_USER_FILTER={{ cookbook.services.mealie.ldap_user_filter | default('(memberOf=)') }}
LDAP_ADMIN_FILTER={{ cookbook.services.mealie.ldap_admin_filter | default('(memberOf=)') }}
{% endif %}

# ------------------------------------------------------------------------------
# Features
# ------------------------------------------------------------------------------
RECIPE_PUBLIC=false
RECIPE_SHOW_NUTRITION=true
RECIPE_SHOW_ASSETS=true
RECIPE_LANDSCAPE_VIEW=true
RECIPE_DISABLE_COMMENTS=false
RECIPE_DISABLE_AMOUNT=false
