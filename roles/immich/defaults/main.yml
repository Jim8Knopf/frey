---
# ==============================================================================
# IMMICH ROLE - DEFAULT VARIABLES
# ==============================================================================

immich:
  group:
    name: photos
    gid: 74686
  user:
    name: photos_manager
    uid: 74686
    groups: "{{ immich.group.name }}"
  dir: "{{ storage.base_dir }}/photos"

  services:
    immich:
      enabled: true
      version: "release"
      port: 2283
      # Hardware acceleration for Pi 5
      hw_accel: "rkmpp"  # RK3588 hardware acceleration
      # Storage paths
      upload_location: "{{ storage.base_dir }}/photos/library"
      db_data_location: "{{ storage.appdata_dir }}/immich-db"
      ml_cache_location: "{{ storage.appdata_dir }}/immich-ml-cache"
      # OIDC/SSO Configuration (enabled when infrastructure.services.authentik.enabled is true)
      # Issuer URL uses auth.frey DNS (accessible via localdns Docker network)
      # NOTE: OAuth must be enabled in Immich UI: Administration → Settings → OAuth Authentication
      oidc_issuer_url: "https://auth.{{ network.domain_name }}/application/o/immich/"
      oidc_client_id: "immich"
      oidc_scope: "openid profile email"
      oidc_button_text: "Login with Authentik"
      oidc_auto_register: true
      oidc_auto_launch: false
      oidc_mobile_redirect_uri: "app.immich:/"
      oidc_signing_algorithm: "RS256"
