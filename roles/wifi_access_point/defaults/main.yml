---
# ==============================================================================
# WIFI ACCESS POINT ROLE - DEFAULT VARIABLES
# ==============================================================================

# Packages to install (kept minimal)
wifi_ap_packages:
  - hostapd
  - dnsmasq
  - dhcpcd5
  - iw
  - rfkill
  - wpasupplicant
  - jq

# Safety guard: set to true to force apply even if the AP interface equals the control interface
force_apply: false

# Network configuration for WiFi Access Point
network:
  # DNS domain for local rewrites (defaults, can be overridden in group_vars)
  domain_name: "frey"
  dns_rewrites: []

  wifi:
    # Enable NAT from AP network to client/uplink interface
    enable_nat: true  # Enable for internet passthrough to AP clients
    # Method to persist NAT rules: 'iptables-persistent' or 'iptables-save'
    nat_persist_method: 'iptables-persistent'
    # Network identification
    ssid: "FreyHub"                 # Network name visible to clients
    password: "{{ wifi_ap.password }}"  # Password from secrets.yml

    # Geographic settings (affects channels and power levels)
    country: "AU"                   # Two-letter country code

    # Network configuration
    ip: "10.20.0.1"                # AP's IP address
    network: "10.20.0.0/24"        # Network subnet for WiFi clients
    dhcp_range_start: "10.20.0.50" # Start of DHCP address pool
    dhcp_range_end: "10.20.0.150"  # End of DHCP address pool

    # Interface configuration
    interface: "wlan1"             # WiFi interface for AP mode
    client_interface: "wlan0"      # Client interface for roaming
    client_interface_ip: "192.168.0.252" #TODO Client interface IP (for authentik)
    roaming:
      enabled: true
      daemon_enabled: true  # Enable automatic WiFi roaming daemon
      client_interface: "wlan0"  # Interface for connecting to public WiFi
      mqtt_topic: "frey/wifi/roaming"
      known_networks: "{{ network.wifi.roaming.known_networks | default([]) }}"  # From secrets.yml
      mqtt:
        enabled: false
        broker: "localhost"
        port: 1883

    # WiFi radio settings
    # Set hw_mode to 'auto' to prefer 5GHz when supported, else fall back to 2.4GHz
    hw_mode: auto                  # auto: prefer 5GHz (a) if supported; else 2.4GHz (g)
    # channel: 7                     # Desired channel; auto logic overrides to 36 on 5GHz if invalid
    ieee80211n: 1                  # Enable 802.11n features
    wmm_enabled: 1                 # Enable WiFi multimedia (QoS)

    # Security settings
    macaddr_acl: 0                 # MAC address filtering
    auth_algs: 1                   # WPA authentication
    ignore_broadcast_ssid: 0       # Broadcast SSID

    # DNS configuration
    upstream_dns_servers:
      - "1.1.1.1"
      - "8.8.8.8"
    use_system_dns: true
    system_resolv_conf: "/etc/resolv.conf"

    # Power management
    power_management:
      disable_power_save: true
      extra_interfaces: []

    # Virtual AP configuration (for creating AP from client interface)
    virtual_ap:
      enabled: false
      source_interface: "{{ network.wifi.client_interface }}"
      ensure_interval: 15

    # Connectivity monitoring (checks if client interface has internet)
    connectivity_monitor:
      enabled: false  # Disabled by default; enable explicitly after confirming dhcpcd is working
      ping_target: null
      ping_count: 3
      failure_threshold: 1
      interval_seconds: 60
      restart_dhcpcd: true
      restart_wpa_supplicant: true
