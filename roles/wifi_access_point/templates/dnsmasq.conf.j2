# DHCP server configuration for WiFi AP
# Basic settings
bind-dynamic
listen-address={{ wifi.ip }}
interface={{ wifi.interface }}
except-interface=lo

# Process settings
user=root
group=root
pid-file=/var/run/dnsmasq/dnsmasq.pid

# DNS settings
port=53
no-resolv
server=8.8.8.8
server=8.8.4.4

# DNS options
domain-needed
bogus-priv
local-ttl=120

# DHCP range and lease time
dhcp-range={{ wifi.dhcp_range_start }},{{ wifi.dhcp_range_end }},255.255.255.0,24h
dhcp-option=option:router,{{ wifi.ip }}
dhcp-option=option:dns-server,{{ wifi.ip }}
dhcp-authoritative

# Logging
log-queries
log-dhcp

# Local DNS
local=/frey/
domain=frey
expand-hosts
{% for service in network.dns_rewrites %}
address=/{{ service.name }}.{{ network.domain_name }}/{{ ansible_host }}
{% endfor %}
