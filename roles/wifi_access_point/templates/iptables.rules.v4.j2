# Generated by Ansible - DO NOT EDIT MANUALLY
*filter
:INPUT ACCEPT [0:0]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]

# Allow established connections
-A FORWARD -i {{ ansible_default_ipv4.interface }} -o {{ wifi_ap_interface }} -m state --state RELATED,ESTABLISHED -j ACCEPT
-A FORWARD -i {{ wifi_ap_interface }} -o {{ ansible_default_ipv4.interface }} -j ACCEPT

# Allow DNS and DHCP on AP interface
-A INPUT -i {{ wifi_ap_interface }} -p udp --dport 53 -j ACCEPT
-A INPUT -i {{ wifi_ap_interface }} -p tcp --dport 53 -j ACCEPT
-A INPUT -i {{ wifi_ap_interface }} -p udp --dport 67 -j ACCEPT

COMMIT

*nat
:PREROUTING ACCEPT [0:0]
:INPUT ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
:POSTROUTING ACCEPT [0:0]

# NAT for AP network
-A POSTROUTING -s {{ wifi_ap_ip | regex_replace('\\.[0-9]+$', '.0/24') }} -o {{ ansible_default_ipv4.interface }} -j MASQUERADE

COMMIT
