[Unit]
Description=Frey WiFi Daemon - Automatic Roaming Service
Documentation=file:///opt/frey/docs/WIFI_ROAMING.md
After=network.target wpa_supplicant.service dhcpcd.service
Wants=network.target
# Start after WiFi AP is up (if enabled)
After=hostapd.service dnsmasq.service
# Controlled by network.wifi.roaming.enabled in group_vars/all/main.yml
{% if network.wifi.roaming.enabled is defined and not network.wifi.roaming.enabled %}
ConditionPathExists=/etc/frey/roaming-disabled
{% endif %}

[Service]
Type=simple
ExecStart=/usr/local/bin/frey-wifi-roaming-daemon --foreground
Restart=always
RestartSec=10
StandardOutput=journal
StandardError=journal
SyslogIdentifier=frey-wifid

# Security hardening (temporarily disabled for debugging)
#NoNewPrivileges=false
#PrivateTmp=yes
#ProtectSystem=strict
#ProtectHome=yes
#ReadWritePaths=/var/log /var/lib/frey /var/run /etc/frey

# Allow network configuration
AmbientCapabilities=CAP_NET_ADMIN CAP_NET_RAW
CapabilityBoundingSet=CAP_NET_ADMIN CAP_NET_RAW

# Resource limits
MemoryMax=100M
CPUQuota=25%

# Environment
Environment="PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"

[Install]
WantedBy=multi-user.target
