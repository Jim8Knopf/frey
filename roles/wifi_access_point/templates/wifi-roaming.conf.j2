# ==============================================================================
# FREY WIFI ROAMING CONFIGURATION
# ==============================================================================
# Configuration file for the automatic WiFi roaming daemon
# Location: /etc/frey/wifi-roaming.conf

# ==============================================================================
# Network Interface
# ==============================================================================
# Interface used for client WiFi connections (usually wlan0)
INTERFACE_CLIENT="{{ network.wifi.client_interface | default('wlan0') }}"

# ==============================================================================
# Scanning Behavior (seconds)
# ==============================================================================
# Configurable from group_vars/all/main.yml (network.wifi.roaming.scan_intervals)
# Default scan interval (used in most situations)
SCAN_INTERVAL_DEFAULT={{ network.wifi.roaming.scan_intervals.default | default(120) }}

# Balanced scanning when no WiFi connection (was 30s - too aggressive)
SCAN_INTERVAL_NO_CONNECTION={{ network.wifi.roaming.scan_intervals.no_connection | default(120) }}

# Balanced scanning when connected but no internet (captive portal, etc.)
SCAN_INTERVAL_NO_INTERNET={{ network.wifi.roaming.scan_intervals.no_internet | default(180) }}

# Conservative scanning when everything is working well
SCAN_INTERVAL_GOOD={{ network.wifi.roaming.scan_intervals.good | default(900) }}

# ==============================================================================
# Connection Thresholds
# ==============================================================================
# Minimum signal strength (dBm) - don't connect to weaker networks
MIN_SIGNAL_DBM=-85

# Score difference required to switch networks (prevents constant switching)
# If new network score is > (current score + this threshold), switch
SWITCH_THRESHOLD=15

# Timeout for internet verification (seconds)
INTERNET_TIMEOUT=10

# ==============================================================================
# Network Preferences
# ==============================================================================
# Prioritize saved/known networks over open networks
PREFER_KNOWN_NETWORKS=true

# Allow connections to open (no password) networks
ALLOW_OPEN_NETWORKS=true

# Attempt automatic captive portal authentication
AUTO_PORTAL_AUTH=true

# ==============================================================================
# MQTT Configuration (Home Assistant / n8n Integration)
# ==============================================================================
MQTT_ENABLED={{ network.wifi.roaming.mqtt.enabled | default(false) | lower }}
MQTT_BROKER="{{ network.wifi.roaming.mqtt.broker | default('localhost') }}"
MQTT_PORT={{ network.wifi.roaming.mqtt.port | default(1883) }}
MQTT_TOPIC_PREFIX="{{ network.wifi.roaming.mqtt_topic | default('frey/wifi/roaming') }}"

# MQTT Authentication (optional)
# MQTT_USERNAME=""
# MQTT_PASSWORD=""

# ==============================================================================
# Logging
# ==============================================================================
LOG_FILE="/var/log/frey-wifi-roaming.log"
LOG_LEVEL="INFO"  # DEBUG, INFO, WARN, ERROR

# ==============================================================================
# Blacklist Patterns (regex)
# ==============================================================================
# Networks matching these patterns will never be connected to
# Useful for filtering out IoT devices, printers, etc.
BLACKLIST_PATTERNS=(
    ".*-printer.*"
    ".*-iot.*"
    ".*-setup.*"
    "HP-.*"
    "Canon_.*"
    "Brother_.*"
    "DIRECT-.*"              # WiFi Direct devices
    ".*_nomap"              # Privacy-focused networks asking not to be mapped
    ".*\[hidden\].*"        # Hidden SSIDs
{% if network.wifi.ssid is defined and (network.wifi.ssid | string | length) > 0 %}
    "{{ network.wifi.ssid }}"       # Avoid connecting to our own AP
{% endif %}
{% if network.wifi.virtual_ap is defined and (network.wifi.virtual_ap.ssid | default('') | string | length) > 0 %}
    "{{ network.wifi.virtual_ap.ssid }}"  # Avoid connecting to any virtual AP SSID
{% endif %}
)

# ==============================================================================
# Whitelist Patterns (optional)
# ==============================================================================
# If specified, ONLY networks matching these patterns will be considered
# Leave empty to allow all networks (subject to blacklist)
WHITELIST_PATTERNS=(
    # Examples (commented out by default):
    # ".*Free.*WiFi.*"
    # "Starbucks.*"
    # "Hotel.*"
)

# ==============================================================================
# Advanced Settings
# ==============================================================================
# Maximum connection attempts before blacklisting network
MAX_CONNECTION_ATTEMPTS=3

# Blacklist duration after failed connections (seconds)
BLACKLIST_DURATION=300  # 5 minutes

# Enable experimental features
EXPERIMENTAL_FEATURES=false
