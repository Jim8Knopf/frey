#!/bin/bash
# Voice Assistant Entrypoint Script
# Installs dependencies and starts the assistant

set -e

echo "======================================"
echo "Frey Voice Assistant"
echo "======================================"

# Check if dependencies are installed
if [ ! -f /app/.dependencies_installed ]; then
    echo "Installing Python dependencies..."
    apt-get update -qq
    apt-get install -y --no-install-recommends \
        portaudio19-dev \
        alsa-utils \
        python3-dev \
        gcc \
        build-essential \
        > /dev/null 2>&1

    pip3 install --no-cache-dir -r /app/requirements.txt

    # Mark as installed
    touch /app/.dependencies_installed
    echo "✓ Dependencies installed"
else
    echo "✓ Dependencies already installed"
fi

# Check audio devices
echo ""
echo "Checking audio devices..."
if ls /dev/snd/* > /dev/null 2>&1; then
    echo "✓ Audio devices found:"
    ls -la /dev/snd/ | grep -v total
else
    echo "⚠ WARNING: No audio devices found in /dev/snd/"
    echo "  Voice assistant may not work without audio devices"
fi

echo ""
echo "Starting voice assistant..."
echo "======================================"
echo ""

# Start the main application
exec python3 -u main.py
