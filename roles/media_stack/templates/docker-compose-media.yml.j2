networks:
  frey-net:
    driver: bridge

services:
  jellyfin:
    image: linuxserver/jellyfin:latest
    container_name: jellyfin
    environment:
      - PUID={{ media_uid }}
      - PGID={{ media_gid }}
      - TZ={{ timezone }}
    volumes:
      - "{{ appdata_dir }}/jellyfin:/config"
      - "{{ media_dir }}:/data/media"
    ports:
      - "{{ jellyfin_port }}:8096"
    networks: [frey-net]
    restart: unless-stopped

  sonarr:
    image: linuxserver/sonarr:latest
    container_name: sonarr
    environment:
      - PUID={{ media_uid }}
      - PGID={{ media_gid }}
      - TZ={{ timezone }}
    volumes:
      - "{{ appdata_dir }}/sonarr:/config"
      - "{{ downloads_dir }}:/downloads"
      - "{{ media_dir }}/tv:/tv"
    ports:
      - "{{ sonarr_port }}:8989"
    networks: [frey-net]
    restart: unless-stopped

  radarr:
    image: linuxserver/radarr:latest
    container_name: radarr
    environment:
      - PUID={{ media_uid }}
      - PGID={{ media_gid }}
      - TZ={{ timezone }}
    volumes:
      - "{{ appdata_dir }}/radarr:/config"
      - "{{ downloads_dir }}:/downloads"
      - "{{ media_dir }}/movies:/movies"
    ports:
      - "{{ radarr_port }}:7878"
    networks: [frey-net]
    restart: unless-stopped

  prowlarr:
    image: linuxserver/prowlarr:latest
    container_name: prowlarr
    environment:
      - PUID={{ media_uid }}
      - PGID={{ media_gid }}
      - TZ={{ timezone }}
    volumes:
      - "{{ appdata_dir }}/prowlarr:/config"
    ports:
      - "{{ prowlarr_port }}:9696"
    networks: [frey-net]
    restart: unless-stopped

  qbittorrent:
    image: linuxserver/qbittorrent:latest
    container_name: qbittorrent
    environment:
      - PUID={{ media_uid }}
      - PGID={{ media_gid }}
      - TZ={{ timezone }}
      - WEBUI_PORT={{ qbittorrent_port }}
    volumes:
      - "{{ appdata_dir }}/qbittorrent:/config"
      - "{{ downloads_dir }}:/downloads"
    ports:
      - "{{ qbittorrent_port }}:{{ qbittorrent_port }}"
      - "6881:6881"
      - "6881:6881/udp"
    networks: [frey-net]
    restart: unless-stopped

  bazarr:
    image: linuxserver/bazarr:latest
    container_name: bazarr
    environment:
      - PUID={{ media_uid }}
      - PGID={{ media_gid }}
      - TZ={{ timezone }}
    volumes:
      - "{{ appdata_dir }}/bazarr:/config"
      - "{{ media_dir }}/movies:/movies"
      - "{{ media_dir }}/tv:/tv"
    ports:
      - "{{ bazarr_port }}:6767"
    networks: [frey-net]
    restart: unless-stopped

  # readarr:
  #   image: hotio/readarr:nightly # Using develop branch for audiobook support
  #   container_name: readarr
  #   environment:
  #     - PUID={{ media_uid }}
  #     - PGID={{ media_gid }}
  #     - TZ={{ timezone }}
  #   volumes:
  #     - "{{ appdata_dir }}/readarr:/config"
  #     - "{{ downloads_dir }}:/downloads"
  #     - "{{ media_dir }}/audiobooks:/audiobooks"
  #     - "{{ media_dir }}/ebooks:/ebooks"
  #   ports:
  #     - "{{ readarr_port }}:8787"
  #   networks: [frey-net]
  #   restart: unless-stopped

  lidarr:
    image: linuxserver/lidarr:latest
    container_name: lidarr
    environment:
      - PUID={{ media_uid }}
      - PGID={{ media_gid }}
      - TZ={{ timezone }}
    volumes:
      - "{{ appdata_dir }}/lidarr:/config"
      - "{{ downloads_dir }}:/downloads"
      - "{{ media_dir }}/music:/music"
    ports:
      - "{{ lidarr_port }}:8686"
    networks: [frey-net]
    restart: unless-stopped

  jellyseerr:
    image: fallenbagel/jellyseerr:latest
    container_name: jellyseerr
    environment:
      - PUID={{ media_uid }}
      - PGID={{ media_gid }}
      - TZ={{ timezone }}
      - LOG_LEVEL=info
    volumes:
      - "{{ appdata_dir }}/jellyseerr:/app/config"
    ports:
      - "{{ jellyseerr_port }}:5055"
    networks: [frey-net]
    restart: unless-stopped

  audiobookshelf:
    image: ghcr.io/advplyr/audiobookshelf:latest
    container_name: audiobookshelf
    environment:
      - PUID={{ media_uid }}
      - PGID={{ media_gid }}
      - TZ={{ timezone }}
    volumes:
      - "{{ appdata_dir }}/audiobookshelf/config:/config"
      - "{{ appdata_dir }}/audiobookshelf/metadata:/metadata"
      - "{{ media_dir }}/audiobooks:/audiobooks"
      - "{{ media_dir }}/podcasts:/podcasts"
    ports:
      - "{{ audiobookshelf_port }}:80"
    networks: [frey-net]
    restart: unless-stopped

  # Fixed Jellystat configuration
  jellystat:
    image: cyfershepard/jellystat:latest
    container_name: jellystat
    environment:
      - PUID={{ media_uid }}
      - PGID={{ media_gid }}
      - TZ={{ timezone }}
      # Required environment variables for Jellystat
      - POSTGRES_USER=jellystat
      - POSTGRES_PASSWORD={{ default_postgres_password }}
      - POSTGRES_IP=jellystat-db
      - POSTGRES_PORT=5432
      - POSTGRES_DATABASE=jfstat
      - JWT_SECRET={{ tandoor_secret_key }}  # Reusing existing secret
    volumes:
      - "{{ appdata_dir }}/jellystat:/app/backend/backup-data"
    ports:
      - "{{ jellystat_port }}:3000"
    networks: [frey-net]
    restart: unless-stopped
    depends_on:
      - jellystat-db

  # PostgreSQL database for Jellystat
  jellystat-db:
    image: postgres:15-alpine
    container_name: jellystat-db
    environment:
      - POSTGRES_DB=jfstat
      - POSTGRES_USER=jellystat
      - POSTGRES_PASSWORD={{ default_postgres_password }}
    volumes:
      - "{{ appdata_dir }}/jellystat-db:/var/lib/postgresql/data"
    networks: [frey-net]
    restart: unless-stopped