---
# ================================
# FEATURE TOGGLES
# ================================
features:
  infrastructure: true
  networking: true
  wifi_access_point: true
  media_stack: true
  file_management: false
  ai_stack: false
  photo_management: false
  homeassistant: false
  monitoring: false
  backup: false
  piper: false
  cookbook: false
  power_monitoring: false

# (No deploy_* compatibility mappings here â€” use `features.*` toggles)

# ================================
# USER CONFIGURATION
# ================================
user:
  name: media
  uid: 1000
  gid: 1000

# ================================
# DOCKER CONFIGURATION
# ================================
docker:
  users: [ "{{ user.name }}" ]

# ================================
# STORAGE PATHS
# ================================
storage:
  base_dir: /opt/frey
  media_dir: "{{ storage.base_dir }}/media"
  appdata_dir: "{{ storage.base_dir }}/appdata"
  downloads_dir: "{{ storage.base_dir }}/downloads"
  photos_dir: "{{ storage.base_dir }}/photos"
  ai_dir: "{{ storage.base_dir }}/ai"
  backups_dir: "{{ storage.base_dir }}/backups"
  logs_dir: "{{ storage.base_dir }}/logs"
  stacks_dir: "{{ storage.base_dir }}/stacks"  # For Dockge

# ==============================================================================
# ROLE: INFRASTRUCTURE & NETWORKING
# ==============================================================================
network:
  domain_name: frey
  timezone: Australia/Hobart
  dns_rewrites:
    - name: jellyfin
    - name: sonarr
    - name: radarr
    - name: bazarr
    - name: audiobookshelf
    - name: qbittorrent
    - name: prowlarr
    - name: dockge
    - name: portainer
    - name: grafana
    - name: uptime-kuma
    - name: traefik
    - name: immich
    - name: cookbook
    - name: jellyseerr
    - name: lidarr
    - name: jellystat
  macvlan:
    enable: false
    physical_interface: "wlan0"
    network_name: "macvlan_net"
    subnet: "192.168.1.0/24"
    gateway: "192.168.1.1"
    ip_range: "192.168.1.200/28"

# ==============================================================================
# ROLE: WIFI_ACCESS_POINT
# ==============================================================================
wifi:
  ssid: "FreyHub"
  password: "YourSecurePassword"
  channel: 7
  country: "AU"
  ip: "192.168.4.1"
  dhcp_range_start: "192.168.4.10"
  dhcp_range_end: "192.168.4.50"
  interface: "wlan1"
  client_interface: "wlan0"
  network: "192.168.4.0/24"
  hw_mode: g
  macaddr_acl: 0
  auth_algs: 1
  ignore_broadcast_ssid: 0
  ieee80211n: 1
  wmm_enabled: 1

# ==============================================================================
# SERVICE PORTS
# ==============================================================================
ports:
  ai_stack:
    ollama: 11434
    openwebui: 3000
  photos_home:
    immich: 2283
    homeassistant: 8123
  infrastructure:
    traefik: 80
    traefik_dashboard: 8081
    portainer: 9000
    dockge: 5001
  monitoring:
    grafana: 3001
    prometheus: 9090
    node_exporter: 9100
    cadvisor: 8082
    loki: 3100
    promtail: 9080
    uptime_kuma: 3002
  file_management:
    filebrowser: 8083
    code_server: 8084
  network_tools:
    speedtest: 8085
    adguardhome: 3053
  cookbook:
    cookbook: 8090
  voice_assistant:
    piper: 10200

# ==============================================================================
# MEDIA STACK
# ==============================================================================
media_stack:
  media_uid: "{{ user.uid }}"
  media_gid: "{{ user.gid }}"
  timezone: "{{ network.timezone }}"
  appdata_dir: "{{ storage.appdata_dir }}"
  media_dir: "{{ storage.media_dir }}"
  downloads_dir: "{{ storage.downloads_dir }}"
  domain_name: "{{ network.domain_name }}"
  jellyfin:
    port: 8096
  sonarr:
    port: 8989
    user: "sonarr_user"
    password: "sonarr_pass_change_me"
  radarr:
    port: 7878
    user: "radarr_user"
    password: "radarr_pass_change_me"
  prowlarr:
    port: 9696
    user: "prowlarr_user"
    password: "prowlarr_pass_change_me"
  qbittorrent:
    port: 8080
  bazarr:
    port: 6767
  lidarr:
    port: 8686
    user: "lidarr_user"
    password: "lidarr_pass_change_me"
  jellyseerr:
    port: 5055
  audiobookshelf:
    port: 13378
  audiobookrequest:
    port: 5432
  jellystat:
    port: 8086
  postgres:
    default_password: "change_me"
  tandoor:
    secret_key: "change_me"

# ==============================================================================
# SECURITY SETTINGS
# ==============================================================================
security:
  fail2ban:
    enable: true
  ufw:
    enable: true
  ssh_port: 22
  firewall_tcp_ports: "{{
    [security.ssh_port, ports.infrastructure.dockge] +
    (features.infrastructure | ternary([ports.infrastructure.traefik, ports.infrastructure.traefik_dashboard, ports.infrastructure.portainer], [])) +
    (features.media_stack | ternary([media_stack.jellyfin.port, media_stack.sonarr.port, media_stack.radarr.port, media_stack.bazarr.port, media_stack.audiobookshelf.port, media_stack.qbittorrent.port, media_stack.prowlarr.port, media_stack.jellyseerr.port, media_stack.lidarr.port, media_stack.jellystat.port], [])) +
    (features.ai_stack | ternary([ports.ai_stack.ollama, ports.ai_stack.openwebui], [])) +
    (features.photo_management | ternary([ports.photos_home.immich], [])) +
    (features.homeassistant | ternary([ports.photos_home.homeassistant], [])) +
    (features.monitoring | ternary([ports.monitoring.grafana, ports.monitoring.prometheus, ports.monitoring.uptime_kuma, ports.network_tools.speedtest], [])) +
    (features.networking | ternary([ports.network_tools.adguardhome], [])) +
    (features.file_management | ternary([ports.file_management.filebrowser, ports.file_management.code_server], [])) +
    (features.cookbook | ternary([ports.cookbook.cookbook], [])) +
    (features.voice_assistant | ternary([ports.voice_assistant.piper], []))
    }}"

# ==============================================================================
# OPTIMIZATION SETTINGS
# ==============================================================================
optimization:
  ssd:
    enable: false
    trim: true
  german_content:
    locale: de_DE.UTF-8
    enable_indexers: true

# ==============================================================================
# POWER MANAGEMENT (12V setup)
# ==============================================================================
power:
  low_threshold: 11.8
  critical_threshold: 11.0
  enable_graceful_shutdown: false

# ================================
# AUTOMATION SETTINGS
# ================================
automation:
  watchtower_interval: 86400
  backup_retention_days: 7

# ================================
# VOICE ASSISTANT
# ================================
voice_assistant:
  deploy: false
  wake_word: "frey"
  porcupine_access_key: "YOUR_PICOVOICE_ACCESS_KEY"
  ollama_model: "llama3:latest"
  piper_voice: "en_US-lessac-medium"
  piper_voices:
    - "en_US-lessac-medium"
    - "en_AU-southern-female"
    - "de_DE-thorsten-medium"