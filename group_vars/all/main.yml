---
# ==============================================================================
# GLOBAL CONFIGURATION VARIABLES
# ==============================================================================
# This file contains only truly global variables that affect multiple roles.
# Role-specific variables have been moved to roles/*/defaults/main.yml

# ================================
# FEATURE TOGGLES
# ================================
# Control which roles are enabled/disabled
features:
  infrastructure: true
  landing_page: false
  networking: true
  wifi_access_point: true
  media: true
  monitoring: true
  automation: true
  authentication: true  # Authelia/LLDAP SSO - enable after initial setup
  file_management: false
  immich: true
  homeassistant: true  # Home Assistant + Piper TTS + Wyoming Whisper STT
  bluetooth_audio: true  # Bluetooth headphones/speakers with auto-connection
  backup: false  # Automated backup system
  cookbook: true
  power_monitoring: false  # Deprecated - use system.power_monitoring.enabled instead
  voice_assistant: false  # Deprecated - integrated into homeassistant role

# ================================
# GLOBAL CONFIGURATION
# ================================
# Admin contact information
admin_email: "Jason.Kolb@ik.me"

# Global user definitions
users:
  default:
    name: else
    uid: 1000
    gid: 1000
  docker:
    name: docker
    uid: 362537
    groups: docker

# ================================
# STORAGE PATHS
# ================================
# Global storage paths used across all roles
storage:
  base_dir: /opt/frey
  appdata_dir: "{{ storage.base_dir }}/appdata"
  stacks: "{{ storage.base_dir }}/stacks"

# ==============================================================================
# NETWORK CONFIGURATION (GLOBAL)
# ==============================================================================
network:
  domain_name: frey
  timezone: Australia/Hobart
  # Authelia public URL for OAuth authorization (browser redirects)
  # Uses DNS via Traefik for clean OAuth flow (primary access method)
  # OAuth: grafana.frey → auth.frey → grafana.frey
  # Works offline via AdGuard local DNS resolution
  authentik_public_url: "https://auth.{{ network.domain_name }}"

  # DNS Service Resolution
  # Services configured here will be accessible via DNS (e.g., http://jellyfin.frey)
  dns_rewrites:
    # Landing + apex host
    - name: frey
      host: "{{ network.domain_name }}"
    - name: landing
    # Landing + apex host
    - name: frey
      host: "{{ network.domain_name }}"
    - name: landing
    # Infrastructure services
    - name: traefik
    - name: portainer
    - name: dockge
    - name: auth  # Authelia/LLDAP SSO
    - name: lldap  # LDAP server
    # Monitoring services
    - name: grafana
    - name: prometheus
    - name: loki
    - name: metrics     # node-exporter
    - name: cadvisor
    - name: speedtest
    - name: uptime-kuma
    # Media services
    - name: jellyfin
    - name: sonarr
    - name: radarr
    - name: bazarr
    - name: audiobookshelf
    - name: audiobookrequest
    - name: nzbget
    - name: flaresolverr
    - name: qbittorrent
    - name: prowlarr
    - name: immich
    - name: cookbook
    - name: jellyseerr
    - name: lidarr
    - name: jellystat
    # Automation + smart home
    - name: homeassistant
    - name: n8n
    # Automation + smart home
    - name: homeassistant
    - name: n8n

# ==============================================================================
# SECURITY SETTINGS (GLOBAL)
# ==============================================================================
# Dynamic firewall port configuration based on enabled features
security:
  fail2ban:
    enable: true
  ufw:
    enable: true
  ssh_port: 22
  # Dynamically computed list of TCP ports to open based on enabled features
  firewall_tcp_ports: "{{
    [security.ssh_port, ports.infrastructure.dockge] +
    (features.infrastructure | ternary([
      ports.infrastructure.traefik,
      ports.infrastructure.traefik_dashboard,
      ports.infrastructure.portainer
    ], [])) +
    (features.media | ternary([
      media.services.jellyfin.port,
      media.services.sonarr.port,
      media.services.radarr.port,
      media.services.bazarr.port,
      media.services.audiobookshelf.port,
      media.services.qbittorrent.port,
      media.services.prowlarr.port,
      media.services.jellyseerr.port,
      media.services.lidarr.port,
      media.services.jellystat.port
    ], [])) +
    (features.automation | ternary([
      automation.ollama.port,
      automation.openwebui.port,
      automation.n8n.port
    ], [])) +
    (features.immich | ternary([
      ports.photos_home.immich
    ], [])) +
    (features.homeassistant | ternary([
      ports.photos_home.homeassistant
    ], [])) +
    (features.monitoring | ternary([
      ports.monitoring.grafana,
      ports.monitoring.prometheus,
      ports.monitoring.uptime_kuma,
      ports.network_tools.speedtest
    ], [])) +
    (features.networking | ternary([
      ports.network_tools.adguardhome
    ], [])) +
    (features.file_management | ternary([
      ports.file_management.filebrowser,
      ports.file_management.code_server
    ], [])) +
    (features.cookbook | ternary([
      cookbook.services.mealie.port
    ], [])) +
    (features.voice_assistant | ternary([
      ports.voice_assistant.piper
    ], []))
    }}"

  # Dynamic TCP firewall ports (public access):
  # - qbittorrent.listen_port (51234): Torrent traffic (peer connections)
  firewall_public_tcp_ports: "{{
    (features.media | ternary([
      media.services.qbittorrent.listen_port
    ], []))
    }}"

  # Dynamic UDP firewall ports:
  # - qbittorrent.listen_port (51234): Torrent traffic
  # - 1900: UPnP SSDP service discovery
  # - 5351: NAT-PMP port mapping
  firewall_udp_ports: "{{
    (features.media | ternary([
      media.services.qbittorrent.listen_port,
      1900,
      5351
    ], []))
    }}"

# ==============================================================================
# OPTIMIZATION SETTINGS (GLOBAL)
# ==============================================================================
optimization:
  ssd:
    enable: false
    trim: true
  german_content:
    locale: de_DE.UTF-8
    enable_indexers: true

# ==============================================================================
# POWER MANAGEMENT (DEPRECATED)
# ==============================================================================
# DEPRECATED: Use system.power_monitoring.* instead (defined in system role)
power:
  low_threshold: 11.8
  critical_threshold: 11.0
  enable_graceful_shutdown: false

# ==============================================================================
# VOICE ASSISTANT (DEPRECATED)
# ==============================================================================
# DEPRECATED: Voice assistant functionality is now integrated into homeassistant role
voice_assistant:
  deploy: true
  wake_word: "frey"
  ollama_model: "llama3:latest"
  piper_voice: "en_US-lessac-medium"
  piper_voices:
    - "en_US-lessac-medium"
    - "en_AU-southern-female"
    - "de_DE-thorsten-medium"
